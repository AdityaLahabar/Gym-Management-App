import{a as he}from"./chunk-4NP5SAQA.js";import{a as ie,b as re,c as oe,d as ce,e as me,f as de,g as le,h as se,i as pe,j as ue,k as fe}from"./chunk-SJPCH2W4.js";import"./chunk-GR6KZ4EE.js";import{a as ne,b as ae}from"./chunk-EZOW7QET.js";import{a as K,c as Q,f as X,g as Z,i as ee,j as te}from"./chunk-OIBLF6JS.js";import{b as Y,f as q,i as G,n as J}from"./chunk-U762ZJBY.js";import"./chunk-EJJBCPAK.js";import{a as L,b as H,c as R,d as z,e as B,f as U,g as W,j}from"./chunk-U2PRCF4C.js";import{c as y,d as P}from"./chunk-S46PGCVJ.js";import{ma as N,pa as F,qa as $,ra as V}from"./chunk-CN72DSDW.js";import{h as E,j as I,m as D,n as O}from"./chunk-BRPU6MQJ.js";import{$a as _,$b as r,Eb as a,Fb as n,Gb as g,Hb as u,Ib as f,Pb as M,Rb as v,_a as c,ac as s,bc as p,cc as k,dc as S,ec as T,gc as A,jc as w,ka as x,kc as C,lc as b,qb as m,vb as d}from"./chunk-HFY3FSCH.js";var ge=(e,t)=>({completed:e,active:t});function Ce(e,t){e&1&&(a(0,"mat-card-footer"),g(1,"mat-progress-bar",15),n())}function be(e,t){e&1&&(a(0,"th",28),r(1,"Name"),n())}function xe(e,t){if(e&1&&(a(0,"td",29),r(1),n()),e&2){let i=t.$implicit;c(),s(i.userName)}}function Me(e,t){e&1&&(a(0,"th",28),r(1,"Membership #"),n())}function ve(e,t){if(e&1&&(a(0,"td",29),r(1),n()),e&2){let i=t.$implicit;c(),p(" ",i.membershipNumber," ")}}function ke(e,t){e&1&&(a(0,"th",28),r(1,"Check In"),n())}function Se(e,t){if(e&1&&(a(0,"td",29),r(1),C(2,"date"),n()),e&2){let i=t.$implicit;c(),p(" ",b(2,1,i.checkInTime,"short")," ")}}function Te(e,t){e&1&&(a(0,"th",28),r(1,"Check Out"),n())}function Ae(e,t){if(e&1&&(a(0,"td",29),r(1),C(2,"date"),n()),e&2){let i=t.$implicit;c(),p(" ",i.checkOutTime?b(2,1,i.checkOutTime,"short"):"Active"," ")}}function we(e,t){e&1&&(a(0,"th",28),r(1,"Status"),n())}function Ee(e,t){if(e&1&&(a(0,"td",29)(1,"span",30),r(2),n()()),e&2){let i=t.$implicit;c(),d("ngClass",w(2,ge,i.checkOutTime,!i.checkOutTime)),c(),p(" ",i.checkOutTime?"Completed":"Active"," ")}}function Ie(e,t){e&1&&g(0,"tr",31)}function De(e,t){e&1&&g(0,"tr",32)}function Oe(e,t){if(e&1&&(a(0,"mat-card",16)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Recent Attendance"),n()(),a(4,"mat-card-content")(5,"div",17)(6,"table",18),u(7,19),m(8,be,2,0,"th",20)(9,xe,2,1,"td",21),f(),u(10,22),m(11,Me,2,0,"th",20)(12,ve,2,1,"td",21),f(),u(13,23),m(14,ke,2,0,"th",20)(15,Se,3,4,"td",21),f(),u(16,24),m(17,Te,2,0,"th",20)(18,Ae,3,4,"td",21),f(),u(19,25),m(20,we,2,0,"th",20)(21,Ee,3,5,"td",21),f(),m(22,Ie,1,0,"tr",26)(23,De,1,0,"tr",27),n()()()()),e&2){let i=v();c(6),d("dataSource",i.recentAttendance),c(16),d("matHeaderRowDef",i.adminColumns),c(),d("matRowDefColumns",i.adminColumns)}}var _e=class e{constructor(t,i,o){this.authService=t;this.attendanceService=i;this.notificationService=o}isLoading=!0;membershipNumber="";allAttendances=[];recentAttendance=[];users=[];userCount=0;adminCount=0;todayAttendanceCount=0;weeklyAttendanceCount=0;adminColumns=["name","membershipNumber","checkInTime","checkOutTime","status"];ngOnInit(){this.loadDashboardData()}loadDashboardData(){this.isLoading=!0,this.authService.getAllUsers().subscribe({next:t=>{this.users=t,this.userCount=t.length,this.adminCount=t.filter(i=>i.role==="admin").length,this.loadAttendanceData()},error:t=>{this.isLoading=!1,console.error("Failed to load users:",t),this.notificationService.showError("Failed to load users")}})}loadAttendanceData(){this.attendanceService.getAllAttendance().subscribe({next:t=>{this.allAttendances=t.sort((l,h)=>new Date(h.checkInTime).getTime()-new Date(l.checkInTime).getTime());let i=new Date;i.setHours(0,0,0,0);let o=new Date;o.setDate(o.getDate()-7),o.setHours(0,0,0,0),this.todayAttendanceCount=t.filter(l=>new Date(l.checkInTime).setHours(0,0,0,0)===i.getTime()).length,this.weeklyAttendanceCount=t.filter(l=>new Date(l.checkInTime)>=o).length,this.recentAttendance=t.slice(0,5),this.isLoading=!1},error:t=>{this.isLoading=!1,console.error("Failed to load attendance:",t),this.notificationService.showError("Failed to load attendance records")}})}get isCheckedIn(){return!!this.allAttendances.find(i=>i.membershipNumber===this.membershipNumber&&!i.checkOutTime&&new Date(i.checkInTime).toDateString()===new Date().toDateString())}recordAttendance(){if(!this.membershipNumber){this.notificationService.showError("Please enter a membership number");return}this.isLoading=!0,(this.isCheckedIn?this.attendanceService.checkOut(this.membershipNumber):this.attendanceService.checkIn(this.membershipNumber)).subscribe({next:()=>{this.notificationService.showSuccess("Attendance recorded successfully"),this.membershipNumber="",this.loadAttendanceData()},error:i=>{this.isLoading=!1,this.notificationService.showError("Error: "+(i.message||"Unknown"))}})}static \u0275fac=function(i){return new(i||e)(_(P),_(he),_(y))};static \u0275cmp=x({type:e,selectors:[["app-tracker-attendance"]],standalone:!0,features:[A],decls:64,vars:12,consts:[[1,"container","attendance-container"],[1,"page-title"],[1,"stats-grid"],[1,"stat-card","fade-in"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"attendance-card","fade-in"],["appearance","outline",1,"membership-input"],["matInput","","placeholder","Enter membership number",3,"ngModelChange","ngModel","disabled"],["matSuffix",""],["mat-raised-button","","color","primary",3,"click","disabled"],[4,"ngIf"],["class","fade-in",4,"ngIf"],["mode","indeterminate"],[1,"fade-in"],[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","membershipNumber"],["matColumnDef","checkInTime"],["matColumnDef","checkOutTime"],["matColumnDef","status"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"status-badge",3,"ngClass"],["mat-header-row",""],["mat-row",""]],template:function(i,o){i&1&&(a(0,"div",0)(1,"h1",1),r(2,"Daily Attendance Tracker (Admin)"),n(),a(3,"div",2)(4,"mat-card",3)(5,"mat-card-content")(6,"div",4)(7,"mat-icon"),r(8,"people"),n()(),a(9,"div",5)(10,"h2",6),r(11),n(),a(12,"p",7),r(13,"Total Users"),n()()()(),a(14,"mat-card",3)(15,"mat-card-content")(16,"div",4)(17,"mat-icon"),r(18,"admin_panel_settings"),n()(),a(19,"div",5)(20,"h2",6),r(21),n(),a(22,"p",7),r(23,"Administrators"),n()()()(),a(24,"mat-card",3)(25,"mat-card-content")(26,"div",4)(27,"mat-icon"),r(28,"checkin"),n()(),a(29,"div",5)(30,"h2",6),r(31),n(),a(32,"p",7),r(33,"Today's Check-ins"),n()()()(),a(34,"mat-card",3)(35,"mat-card-content")(36,"div",4)(37,"mat-icon"),r(38,"calendar_today"),n()(),a(39,"div",5)(40,"h2",6),r(41),n(),a(42,"p",7),r(43,"Weekly Check-ins"),n()()()()(),a(44,"mat-card",8)(45,"mat-card-header")(46,"mat-card-title"),r(47),n(),a(48,"mat-card-subtitle"),r(49,"Enter a member's number to record attendance"),n()(),a(50,"mat-card-content")(51,"mat-form-field",9)(52,"mat-label"),r(53,"Membership Number"),n(),a(54,"input",10),T("ngModelChange",function(h){return S(o.membershipNumber,h)||(o.membershipNumber=h),h}),n(),a(55,"mat-icon",11),r(56,"card_membership"),n()()(),a(57,"mat-card-actions")(58,"button",12),M("click",function(){return o.recordAttendance()}),a(59,"mat-icon"),r(60),n(),r(61),n()(),m(62,Ce,2,0,"mat-card-footer",13),n(),m(63,Oe,24,3,"mat-card",14),n()),i&2&&(c(11),s(o.userCount),c(10),s(o.adminCount),c(10),s(o.todayAttendanceCount),c(10),s(o.weeklyAttendanceCount),c(6),p(" ",o.isCheckedIn?"Check Out":"Check In"," "),c(7),k("ngModel",o.membershipNumber),d("disabled",o.isLoading),c(4),d("disabled",o.isLoading||!o.membershipNumber),c(2),s(o.isCheckedIn?"exit_to_app":"login"),c(),p(" ",o.isCheckedIn?"Check Out":"Check In"," "),c(),d("ngIf",o.isLoading),c(),d("ngIf",o.recentAttendance.length>0))},dependencies:[O,E,I,D,J,Y,q,G,j,L,B,R,W,U,z,H,Z,X,K,Q,te,ee,F,N,V,$,fe,ie,oe,le,ce,re,se,me,de,pe,ue,ae,ne],styles:[".attendance-container[_ngcontent-%COMP%]{padding:24px;max-width:1200px;margin:auto}.page-title[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px;font-size:1.8rem}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin-bottom:32px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px;transition:transform .3s ease}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 4px 12px #00000026}.stat-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:var(--primary-light);color:#fff;width:60px;height:60px;border-radius:50%;margin-right:16px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700}.stat-label[_ngcontent-%COMP%]{font-size:1rem;color:#777}.attendance-card[_ngcontent-%COMP%]{margin-bottom:32px}.membership-input[_ngcontent-%COMP%]{width:100%}.status-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;color:#fff;font-size:.75rem;display:inline-block}.completed[_ngcontent-%COMP%]{background-color:#4caf50}.active[_ngcontent-%COMP%]{background-color:#f44336}.table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;margin-bottom:16px}table[_ngcontent-%COMP%]{width:100%;min-width:600px;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{white-space:nowrap;padding:8px 16px;text-align:left}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;color:#fff;display:inline-block}.status-badge.active[_ngcontent-%COMP%]{background-color:#ff9800}.status-badge.completed[_ngcontent-%COMP%]{background-color:#4caf50}@media (max-width: 768px){mat-card-content[_ngcontent-%COMP%]{padding:8px 0}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:6px 10px;font-size:13px}.status-badge[_ngcontent-%COMP%]{font-size:11px;padding:3px 6px}}"]})};export{_e as TrackerAttendanceComponent};
