import{c as f,d as I}from"./chunk-S46PGCVJ.js";import{aa as S,fa as k,p as m,t as d}from"./chunk-HFY3FSCH.js";var b=class l{constructor(n,e){this.authService=n;this.notificationService=e}attendanceRecords=[{id:"1",userId:"1",userName:"Admin User",membershipNumber:"A001",checkInTime:new Date(Date.now()-864e5).toISOString(),checkOutTime:new Date(Date.now()-864e5+36e5).toISOString()},{id:"2",userId:"2",userName:"Regular Member",membershipNumber:"M001",checkInTime:new Date(Date.now()-432e5).toISOString(),checkOutTime:new Date(Date.now()-432e5+54e5).toISOString()},{id:"3",userId:"3",userName:"Aditya",membershipNumber:"A002",checkInTime:new Date(Date.now()-864e5).toISOString(),checkOutTime:new Date(Date.now()-864e5+36e5).toISOString()},{id:"4",userId:"4",userName:"Veer",membershipNumber:"M002",checkInTime:new Date(Date.now()-432e5).toISOString(),checkOutTime:new Date(Date.now()-432e5+54e5).toISOString()}];checkIn(n){return this.authService.getAllUsers().pipe(d(e=>{let t=e.find(o=>o.membershipNumber===n);if(!t)throw this.notificationService.showError("Invalid membership number"),new Error("Invalid membership number");if(this.attendanceRecords.find(o=>o.userId===t.id&&!o.checkOutTime&&new Date(o.checkInTime).setHours(0,0,0,0)===new Date().setHours(0,0,0,0)))throw this.notificationService.showWarning("User is already checked in"),new Error("User is already checked in");let r={id:(this.attendanceRecords.length+1).toString(),userId:t.id,userName:t.name,membershipNumber:t.membershipNumber,checkInTime:new Date().toISOString()};return this.attendanceRecords.push(r),this.notificationService.showSuccess("Check-in successful"),r}))}checkOut(n){return this.authService.getAllUsers().pipe(d(e=>{let t=e.find(r=>r.membershipNumber===n);if(!t)throw this.notificationService.showError("Invalid membership number"),new Error("Invalid membership number");let s=this.attendanceRecords.findIndex(r=>r.userId===t.id&&!r.checkOutTime);if(s===-1)throw this.notificationService.showWarning("No active check-in found"),new Error("No active check-in found");return this.attendanceRecords[s].checkOutTime=new Date().toISOString(),this.notificationService.showSuccess("Check-out successful"),this.attendanceRecords[s]}))}getUserAttendance(n){let e=this.attendanceRecords.filter(t=>t.userId===n);return m(e)}getAllAttendance(){return m([...this.attendanceRecords].sort((n,e)=>new Date(e.checkInTime).getTime()-new Date(n.checkInTime).getTime()))}getUserStats(n){let e=this.attendanceRecords.filter(c=>c.userId===n);if(!e.length)return m({totalCheckins:0,weeklyCheckins:0,monthlyCheckins:0,averageStayDuration:0});let t=new Date,s=new Date(t.getTime()-7*24*60*60*1e3),r=new Date(t.getTime()-30*24*60*60*1e3),o=e.filter(c=>new Date(c.checkInTime)>=s).length,g=e.filter(c=>new Date(c.checkInTime)>=r).length,a=e.filter(c=>c.checkOutTime),h=a.reduce((c,i)=>{let u=new Date(i.checkOutTime).getTime()-new Date(i.checkInTime).getTime();return c+u},0),w=a.length?Math.round(h/a.length/6e4):0;return m({totalCheckins:e.length,weeklyCheckins:o,monthlyCheckins:g,averageStayDuration:w})}getAllUserStats(){return this.authService.getAllUsers().pipe(d(n=>n.map(e=>{let t=this.attendanceRecords.filter(i=>i.userId===e.id),s=new Date,r=new Date(s.getTime()-7*24*60*60*1e3),o=new Date(s.getTime()-30*24*60*60*1e3),g=t.filter(i=>new Date(i.checkInTime)>=r).length,a=t.filter(i=>new Date(i.checkInTime)>=o).length,h=t.filter(i=>i.checkOutTime),w=h.reduce((i,u)=>{let D=new Date(u.checkOutTime).getTime()-new Date(u.checkInTime).getTime();return i+D},0),c=h.length?Math.round(w/h.length/6e4):0;return{userId:e.id,userName:e.name,totalCheckins:t.length,weeklyCheckins:g,monthlyCheckins:a,averageStayDuration:c}})))}static \u0275fac=function(e){return new(e||l)(k(I),k(f))};static \u0275prov=S({token:l,factory:l.\u0275fac,providedIn:"root"})};export{b as a};
