import{a as Vt}from"./chunk-WCVIBJIK.js";import{a as Et,b as Pt,c as At,d as Rt,e as Lt,f as Bt,g as Ft,h as Ot,i as Nt,j as jt,k as Ht}from"./chunk-SJPCH2W4.js";import{b as Dt,e as St}from"./chunk-OV35W7CK.js";import"./chunk-GR6KZ4EE.js";import{a as wt,b as Mt}from"./chunk-EZOW7QET.js";import{a as _t,b as ut}from"./chunk-Z4V6FUKU.js";import{a as Ct,c as kt,f as Tt,i as xt,j as It}from"./chunk-OIBLF6JS.js";import{b as ft,f as gt,i as vt,n as yt}from"./chunk-U762ZJBY.js";import"./chunk-EJJBCPAK.js";import{a as rt,b as ot,c as st,d as ct,e as dt,f as lt,g as mt,j as bt}from"./chunk-U2PRCF4C.js";import{c as et,d as at}from"./chunk-S46PGCVJ.js";import{X as O,ma as it,pa as nt,qa as ht,ra as pt}from"./chunk-CN72DSDW.js";import{j as X,m as J,n as tt}from"./chunk-BRPU6MQJ.js";import{$a as h,$b as o,Ac as Z,Eb as r,Fb as n,Gb as _,Hb as u,Ib as f,Kb as L,Pb as I,Rb as p,Sb as W,Tb as $,Ub as B,Vb as G,Wb as w,Xb as M,_a as s,ac as g,ba as j,bb as k,bc as b,cc as q,da as T,dc as U,ec as K,fc as D,gb as R,gc as S,hc as F,j as N,ka as x,kc as y,la as H,lb as Q,lc as C,ma as E,nb as z,qb as d,ta as V,ua as P,va as A,vb as c,yc as Y}from"./chunk-HFY3FSCH.js";var Kt=["*"];function Yt(t,a){t&1&&$(0)}var Zt=new T("MatTabContent"),Xt=(()=>{class t{constructor(e){this.template=e}static{this.\u0275fac=function(i){return new(i||t)(h(k))}}static{this.\u0275dir=E({type:t,selectors:[["","matTabContent",""]],standalone:!0,features:[D([{provide:Zt,useExisting:t}])]})}}return t})(),Jt=new T("MatTabLabel"),Qt=new T("MAT_TAB"),te=(()=>{class t extends St{constructor(e,i,l){super(e,i),this._closestTab=l}static{this.\u0275fac=function(i){return new(i||t)(h(k),h(R),h(Qt,8))}}static{this.\u0275dir=E({type:t,selectors:[["","mat-tab-label",""],["","matTabLabel",""]],standalone:!0,features:[D([{provide:Jt,useExisting:t}]),Q]})}}return t})(),ee=new T("MAT_TAB_GROUP"),zt=(()=>{class t{get templateLabel(){return this._templateLabel}set templateLabel(e){this._setTemplateLabelInput(e)}get content(){return this._contentPortal}constructor(e,i){this._viewContainerRef=e,this._closestTabGroup=i,this.disabled=!1,this._explicitContent=void 0,this.textLabel="",this._contentPortal=null,this._stateChanges=new N,this.position=null,this.origin=null,this.isActive=!1}ngOnChanges(e){(e.hasOwnProperty("textLabel")||e.hasOwnProperty("disabled"))&&this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}ngOnInit(){this._contentPortal=new Dt(this._explicitContent||this._implicitContent,this._viewContainerRef)}_setTemplateLabelInput(e){e&&e._closestTab===this&&(this._templateLabel=e)}static{this.\u0275fac=function(i){return new(i||t)(h(R),h(ee,8))}}static{this.\u0275cmp=x({type:t,selectors:[["mat-tab"]],contentQueries:function(i,l,m){if(i&1&&(B(m,te,5),B(m,Xt,7,k)),i&2){let v;w(v=M())&&(l.templateLabel=v.first),w(v=M())&&(l._explicitContent=v.first)}},viewQuery:function(i,l){if(i&1&&G(k,7),i&2){let m;w(m=M())&&(l._implicitContent=m.first)}},hostAttrs:["hidden",""],inputs:{disabled:[2,"disabled","disabled",Y],textLabel:[0,"label","textLabel"],ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],labelClass:"labelClass",bodyClass:"bodyClass"},exportAs:["matTab"],standalone:!0,features:[D([{provide:Qt,useExisting:t}]),z,V,S],ngContentSelectors:Kt,decls:1,vars:0,template:function(i,l){i&1&&(W(),d(0,Yt,1,0,"ng-template"))},encapsulation:2})}}return t})();var Wt=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=H({type:t})}static{this.\u0275inj=j({imports:[O,O]})}}return t})();var $t=()=>["date","checkInTime","checkOutTime","duration"];function ie(t,a){if(t&1&&(r(0,"div",13)(1,"p"),o(2," Your membership number: "),r(3,"strong"),o(4),n()()()),t&2){let e,i=p();s(4),g((e=i.user())==null?null:e.membershipNumber)}}function ne(t,a){if(t&1){let e=L();r(0,"button",14),I("click",function(){P(e);let l=p();return A(l.setCurrentUserMembershipNumber())}),o(1," Use My Number "),n()}if(t&2){let e=p();c("disabled",e.isLoading)}}function re(t,a){t&1&&(r(0,"mat-card-footer"),_(1,"mat-progress-bar",15),n())}function oe(t,a){t&1&&(r(0,"mat-header-cell"),o(1,"Date"),n())}function se(t,a){if(t&1&&(r(0,"mat-cell"),o(1),y(2,"date"),n()),t&2){let e=a.$implicit;s(),b(" ",C(2,1,e.checkInTime,"mediumDate")," ")}}function ce(t,a){t&1&&(r(0,"mat-header-cell"),o(1,"Check In"),n())}function de(t,a){if(t&1&&(r(0,"mat-cell"),o(1),y(2,"date"),n()),t&2){let e=a.$implicit;s(),b(" ",C(2,1,e.checkInTime,"shortTime")," ")}}function le(t,a){t&1&&(r(0,"mat-header-cell"),o(1,"Check Out"),n())}function me(t,a){if(t&1&&(r(0,"mat-cell"),o(1),y(2,"date"),n()),t&2){let e=a.$implicit;s(),b(" ",e.checkOutTime?C(2,1,e.checkOutTime,"shortTime"):"Active"," ")}}function be(t,a){t&1&&(r(0,"mat-header-cell"),o(1,"Duration"),n())}function he(t,a){if(t&1&&(r(0,"mat-cell"),o(1),n()),t&2){let e=a.$implicit,i=p(2);s(),b(" ",i.calculateDuration(e)," ")}}function pe(t,a){t&1&&_(0,"mat-header-row")}function _e(t,a){t&1&&_(0,"mat-row")}function ue(t,a){if(t&1&&(r(0,"div",16)(1,"mat-table",17),u(2,18),d(3,oe,2,0,"mat-header-cell",19)(4,se,3,4,"mat-cell",20),f(),u(5,21),d(6,ce,2,0,"mat-header-cell",19)(7,de,3,4,"mat-cell",20),f(),u(8,22),d(9,le,2,0,"mat-header-cell",19)(10,me,3,4,"mat-cell",20),f(),u(11,23),d(12,be,2,0,"mat-header-cell",19)(13,he,2,1,"mat-cell",20),f(),d(14,pe,1,0,"mat-header-row",24)(15,_e,1,0,"mat-row",25),n()()),t&2){let e=p();s(),c("dataSource",e.userAttendance),s(13),c("matHeaderRowDef",F(3,$t)),s(),c("matRowDefColumns",F(4,$t))}}function fe(t,a){t&1&&(r(0,"h3",34),o(1," No attendance records found. "),n())}function ge(t,a){t&1&&(r(0,"th",40),o(1,"Date"),n())}function ve(t,a){if(t&1&&(r(0,"td",41),o(1),y(2,"date"),n()),t&2){let e=a.$implicit;s(),b(" ",C(2,1,e.checkInTime,"mediumDate")," ")}}function ye(t,a){t&1&&(r(0,"th",40),o(1,"Check In"),n())}function Ce(t,a){if(t&1&&(r(0,"td",41),o(1),y(2,"date"),n()),t&2){let e=a.$implicit;s(),b(" ",C(2,1,e.checkInTime,"shortTime")," ")}}function ke(t,a){t&1&&(r(0,"th",40),o(1,"Check Out"),n())}function Te(t,a){if(t&1&&(r(0,"td",41),o(1),y(2,"date"),n()),t&2){let e=a.$implicit;s(),b(" ",e.checkOutTime?C(2,1,e.checkOutTime,"shortTime"):"Active"," ")}}function xe(t,a){t&1&&(r(0,"th",40),o(1,"Duration"),n())}function Ie(t,a){if(t&1&&(r(0,"td",41),o(1),n()),t&2){let e=a.$implicit,i=p(3);s(),b(" ",i.calculateDuration(e)," ")}}function we(t,a){t&1&&_(0,"tr",42)}function Me(t,a){t&1&&_(0,"tr",43)}function De(t,a){if(t&1&&(r(0,"table",35),u(1,18),d(2,ge,2,0,"th",36)(3,ve,3,4,"td",37),f(),u(4,21),d(5,ye,2,0,"th",36)(6,Ce,3,4,"td",37),f(),u(7,22),d(8,ke,2,0,"th",36)(9,Te,3,4,"td",37),f(),u(10,23),d(11,xe,2,0,"th",36)(12,Ie,2,1,"td",37),f(),d(13,we,1,0,"tr",38)(14,Me,1,0,"tr",39),n()),t&2){let e=p(2);c("dataSource",e.userAttendance),s(13),c("matHeaderRowDef",e.displayedColumns),s(),c("matRowDefColumns",e.displayedColumns)}}function Se(t,a){if(t&1&&(r(0,"div",44)(1,"div",45)(2,"div",46),o(3,"Total Check-ins"),n(),r(4,"div",47),o(5),n()(),_(6,"mat-divider"),r(7,"div",45)(8,"div",46),o(9,"This Week"),n(),r(10,"div",47),o(11),n()(),_(12,"mat-divider"),r(13,"div",45)(14,"div",46),o(15,"This Month"),n(),r(16,"div",47),o(17),n()(),_(18,"mat-divider"),r(19,"div",45)(20,"div",46),o(21,"Avg. Session Duration"),n(),r(22,"div",47),o(23),n()()()),t&2){let e=p(2);s(5),g(e.stats.totalCheckins),s(6),g(e.stats.weeklyCheckins),s(6),g(e.stats.monthlyCheckins),s(6),b(" ",e.stats.averageStayDuration," min ")}}function Ee(t,a){t&1&&(r(0,"div",48)(1,"p"),o(2,"No attendance statistics available yet."),n()())}function Pe(t,a){if(t&1&&(u(0),r(1,"mat-card",26)(2,"mat-tabs")(3,"mat-tab",27)(4,"div",28),d(5,fe,2,0,"h3",29)(6,De,15,3,"table",30),n()(),r(7,"mat-tab",31),d(8,Se,24,4,"div",32)(9,Ee,3,0,"div",33),n()()(),f()),t&2){let e=p();s(5),c("ngIf",e.userAttendance.length===0),s(),c("ngIf",e.userAttendance.length>0),s(2),c("ngIf",e.stats),s(),c("ngIf",!e.stats||e.stats.totalCheckins===0)}}var Gt=class t{constructor(a,e,i){this.attendanceService=a;this.authService=e;this.notificationService=i}membershipNumber="";isLoading=!1;userAttendance=[];stats=null;displayedColumns=["date","checkInTime","checkOutTime","duration"];ngOnInit(){this.loadUserAttendance()}user=Z(()=>this.authService.user());get isCheckedIn(){return this.userAttendance.length?!!this.userAttendance.find(e=>e.userId===this.user()?.id&&!e.checkOutTime&&new Date(e.checkInTime).setHours(0,0,0,0)===new Date().setHours(0,0,0,0)):!1}setCurrentUserMembershipNumber(){this.user()?.membershipNumber&&(this.membershipNumber=this.user()?.membershipNumber||"")}recordAttendance(){if(!this.membershipNumber){this.notificationService.showError("Please enter a membership number");return}this.isLoading=!0,this.isCheckedIn?this.attendanceService.checkOut(this.membershipNumber).subscribe({next:a=>{this.isLoading=!1,this.loadUserAttendance()},error:a=>{this.isLoading=!1,this.notificationService.showError(a.message||"Failed to check out")}}):this.attendanceService.checkIn(this.membershipNumber).subscribe({next:a=>{this.isLoading=!1,this.loadUserAttendance()},error:a=>{this.isLoading=!1,this.notificationService.showError(a.message||"Failed to check in")}})}loadUserAttendance(){this.user()&&(this.isLoading=!0,this.attendanceService.getUserAttendance(this.user().id).subscribe({next:a=>{this.userAttendance=a.sort((e,i)=>new Date(i.checkInTime).getTime()-new Date(e.checkInTime).getTime()),this.isLoading=!1,this.loadUserStats()},error:a=>{this.isLoading=!1,this.notificationService.showError("Failed to load attendance history")}}))}loadUserStats(){this.user()&&this.attendanceService.getUserStats(this.user().id).subscribe({next:a=>{this.stats=a},error:a=>{this.notificationService.showError("Failed to load attendance statistics")}})}calculateDuration(a){if(!a.checkOutTime)return"Active";let e=new Date(a.checkInTime).getTime(),l=new Date(a.checkOutTime).getTime()-e,m=Math.floor(l/(1e3*60*60)),v=Math.floor(l%(1e3*60*60)/(1e3*60));return m>0?`${m}h ${v}m`:`${v}m`}static \u0275fac=function(e){return new(e||t)(h(Vt),h(at),h(et))};static \u0275cmp=x({type:t,selectors:[["app-attendance"]],standalone:!0,features:[S],decls:28,vars:12,consts:[[1,"container","attendance-container"],[1,"page-title"],[1,"attendance-content"],[1,"attendance-card","fade-in"],[1,"attendance-form"],["appearance","outline",1,"membership-input"],["matInput","","placeholder","Enter your membership number",3,"ngModelChange","ngModel","disabled"],["matSuffix",""],["class","current-user-info",4,"ngIf"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-button","",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["class","fade-in-table",4,"ngIf"],[1,"current-user-info"],["mat-button","",3,"click","disabled"],["mode","indeterminate"],[1,"fade-in-table"],[1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","date"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","checkInTime"],["matColumnDef","checkOutTime"],["matColumnDef","duration"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[1,"attendance-records-card","fade-in"],["label","Attendance History"],[1,"attendance-history-content"],["class","no-records-message",4,"ngIf"],["mat-table","",3,"dataSource",4,"ngIf"],["label","Statistics"],["class","attendance-stats-content",4,"ngIf"],["class","no-stats-message",4,"ngIf"],[1,"no-records-message"],["mat-table","",3,"dataSource"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"attendance-stats-content"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value"],[1,"no-stats-message"]],template:function(e,i){if(e&1&&(r(0,"div",0)(1,"h1",1),o(2,"Attendances"),n(),r(3,"div",2)(4,"mat-card",3)(5,"mat-card-header")(6,"mat-card-title"),o(7),n(),r(8,"mat-card-subtitle"),o(9),n()(),r(10,"mat-card-content")(11,"div",4)(12,"mat-form-field",5)(13,"mat-label"),o(14,"Membership Number"),n(),r(15,"input",6),K("ngModelChange",function(m){return U(i.membershipNumber,m)||(i.membershipNumber=m),m}),n(),r(16,"mat-icon",7),o(17,"card_membership"),n()(),d(18,ie,5,1,"div",8),n()(),r(19,"mat-card-actions")(20,"button",9),I("click",function(){return i.recordAttendance()}),r(21,"mat-icon"),o(22),n(),o(23),n(),d(24,ne,2,1,"button",10),n(),d(25,re,2,0,"mat-card-footer",11),n(),d(26,ue,16,5,"div",12)(27,Pe,10,4,"ng-container",11),n()()),e&2){let l;s(7),g(i.isCheckedIn?"Check Out":"Check In"),s(2),b(" ",i.isCheckedIn?"Record your exit time":"Record your gym visit"," "),s(6),q("ngModel",i.membershipNumber),c("disabled",i.isLoading),s(3),c("ngIf",i.user()),s(2),c("disabled",i.isLoading||!i.membershipNumber),s(2),g(i.isCheckedIn?"exit_to_app":"login"),s(),b(" ",i.isCheckedIn?"Check Out":"Check In"," "),s(),c("ngIf",((l=i.user())==null?null:l.membershipNumber)&&!i.membershipNumber),s(),c("ngIf",i.isLoading),s(),c("ngIf",i.userAttendance.length>0),s(),c("ngIf",i.user())}},dependencies:[tt,X,J,yt,ft,gt,vt,bt,rt,dt,st,mt,lt,ct,ot,It,xt,Tt,Ct,kt,nt,it,pt,ht,Wt,zt,Ht,Et,At,Ft,Rt,Pt,Ot,Lt,Bt,Nt,jt,Mt,wt,ut,_t],styles:[".attendance-container[_ngcontent-%COMP%]{padding:24px 16px}.page-title[_ngcontent-%COMP%]{margin-bottom:24px;text-align:center}.attendance-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;max-width:800px;margin:0 auto}.attendance-card[_ngcontent-%COMP%], .attendance-records-card[_ngcontent-%COMP%]{width:100%}.attendance-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin:16px 0}.membership-input[_ngcontent-%COMP%]{width:100%}.current-user-info[_ngcontent-%COMP%]{margin:8px 0;font-size:.9rem;color:var(--gray-700)}.mat-mdc-card-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:16px}.attendance-history-content[_ngcontent-%COMP%], .attendance-stats-content[_ngcontent-%COMP%]{padding:16px}.no-records-message[_ngcontent-%COMP%], .no-stats-message[_ngcontent-%COMP%]{text-align:center;padding:24px;color:var(--gray-600)}table[_ngcontent-%COMP%], mat-table[_ngcontent-%COMP%]{width:100%;border:1px solid #ccc}mat-header-cell[_ngcontent-%COMP%], mat-cell[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #ddd}.fade-in-table[_ngcontent-%COMP%]{opacity:0;animation:_ngcontent-%COMP%_fadeIn 1s ease-in-out forwards}@keyframes _ngcontent-%COMP%_fadeIn{to{opacity:1}}.stat-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 0}.stat-label[_ngcontent-%COMP%]{font-weight:500;color:var(--gray-700)}.stat-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--primary)}@media (max-width: 768px){.attendance-content[_ngcontent-%COMP%]{gap:16px}.stat-item[_ngcontent-%COMP%]{padding:12px 0}}"]})};export{Gt as AttendanceComponent};
