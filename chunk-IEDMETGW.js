import{a as _e}from"./chunk-WCVIBJIK.js";import{a as re,b as oe,c as ce,d as me,e as de,f as le,g as se,h as pe,i as ue,j as fe,k as he}from"./chunk-SJPCH2W4.js";import"./chunk-GR6KZ4EE.js";import{a as ae,b as ie}from"./chunk-EZOW7QET.js";import{a as Q,c as X,f as Z,g as ee,i as te,j as ne}from"./chunk-OIBLF6JS.js";import{b as q,f as G,i as J,n as K}from"./chunk-U762ZJBY.js";import"./chunk-EJJBCPAK.js";import{a as H,b as R,c as z,d as B,e as $,f as U,g as W,j}from"./chunk-U2PRCF4C.js";import{c as P,d as N}from"./chunk-S46PGCVJ.js";import{ma as F,pa as L,qa as V,ra as Y}from"./chunk-CN72DSDW.js";import{h as D,j as I,m as O,n as y}from"./chunk-BRPU6MQJ.js";import{$a as _,$b as r,Eb as i,Fb as n,Gb as g,Hb as u,Ib as f,Pb as v,Rb as C,_a as c,ac as h,bc as p,cc as S,dc as T,ec as A,gc as w,jc as E,ka as M,kc as x,lc as b,qb as d,vb as l}from"./chunk-HFY3FSCH.js";var Ce=(t,e)=>({completed:t,active:e});function xe(t,e){t&1&&(i(0,"mat-card-footer"),g(1,"mat-progress-bar",15),n())}function be(t,e){t&1&&(i(0,"th",29),r(1,"Name"),n())}function ke(t,e){if(t&1&&(i(0,"td",30),r(1),n()),t&2){let a=e.$implicit;c(),h(a.userName)}}function Me(t,e){t&1&&(i(0,"th",29),r(1,"Membership #"),n())}function ve(t,e){if(t&1&&(i(0,"td",30),r(1),n()),t&2){let a=e.$implicit;c(),p(" ",a.membershipNumber," ")}}function Se(t,e){t&1&&(i(0,"th",29),r(1,"Check In"),n())}function Te(t,e){if(t&1&&(i(0,"td",30),r(1),x(2,"date"),n()),t&2){let a=e.$implicit;c(),p(" ",b(2,1,a.checkInTime,"short")," ")}}function Ae(t,e){t&1&&(i(0,"th",29),r(1,"Check Out"),n())}function we(t,e){if(t&1&&(i(0,"td",30),r(1),x(2,"date"),n()),t&2){let a=e.$implicit;c(),p(" ",a.checkOutTime?b(2,1,a.checkOutTime,"short"):"Active"," ")}}function Ee(t,e){t&1&&(i(0,"th",29),r(1,"Duration"),n())}function De(t,e){if(t&1&&(i(0,"td",30),r(1),n()),t&2){let a=e.$implicit,o=C(2);c(),p(" ",o.calculateDuration(a)," ")}}function Ie(t,e){t&1&&(i(0,"th",29),r(1,"Status"),n())}function Oe(t,e){if(t&1&&(i(0,"td",30)(1,"span",31),r(2),n()()),t&2){let a=e.$implicit;c(),l("ngClass",E(2,Ce,a.checkOutTime,!a.checkOutTime)),c(),p(" ",a.checkOutTime?"Completed":"Active"," ")}}function ye(t,e){t&1&&g(0,"tr",32)}function Pe(t,e){t&1&&g(0,"tr",33)}function Ne(t,e){if(t&1&&(i(0,"mat-card",16)(1,"mat-card-header")(2,"mat-card-title"),r(3,"Recent Attendance"),n()(),i(4,"mat-card-content")(5,"div",17)(6,"table",18),u(7,19),d(8,be,2,0,"th",20)(9,ke,2,1,"td",21),f(),u(10,22),d(11,Me,2,0,"th",20)(12,ve,2,1,"td",21),f(),u(13,23),d(14,Se,2,0,"th",20)(15,Te,3,4,"td",21),f(),u(16,24),d(17,Ae,2,0,"th",20)(18,we,3,4,"td",21),f(),u(19,25),d(20,Ee,2,0,"th",20)(21,De,2,1,"td",21),f(),u(22,26),d(23,Ie,2,0,"th",20)(24,Oe,3,5,"td",21),f(),d(25,ye,1,0,"tr",27)(26,Pe,1,0,"tr",28),n()()()()),t&2){let a=C();c(6),l("dataSource",a.recentAttendance),c(19),l("matHeaderRowDef",a.adminColumns),c(),l("matRowDefColumns",a.adminColumns)}}var ge=class t{constructor(e,a,o){this.authService=e;this.attendanceService=a;this.notificationService=o}isLoading=!0;membershipNumber="";allAttendances=[];recentAttendance=[];users=[];userCount=0;adminCount=0;todayAttendanceCount=0;weeklyAttendanceCount=0;adminColumns=["name","membershipNumber","checkInTime","checkOutTime","duration","status"];ngOnInit(){this.loadDashboardData()}loadDashboardData(){this.isLoading=!0,this.authService.getAllUsers().subscribe({next:e=>{this.users=e,this.userCount=e.length,this.adminCount=e.filter(a=>a.role==="admin").length,this.loadAttendanceData()},error:e=>{this.isLoading=!1,console.error("Failed to load users:",e),this.notificationService.showError("Failed to load users")}})}loadAttendanceData(){this.attendanceService.getAllAttendance().subscribe({next:e=>{this.allAttendances=e.sort((m,s)=>new Date(s.checkInTime).getTime()-new Date(m.checkInTime).getTime());let a=new Date;a.setHours(0,0,0,0);let o=new Date;o.setDate(o.getDate()-7),o.setHours(0,0,0,0),this.todayAttendanceCount=e.filter(m=>new Date(m.checkInTime).setHours(0,0,0,0)===a.getTime()).length,this.weeklyAttendanceCount=e.filter(m=>new Date(m.checkInTime)>=o).length,this.recentAttendance=e.slice(0,5),this.isLoading=!1},error:e=>{this.isLoading=!1,console.error("Failed to load attendance:",e),this.notificationService.showError("Failed to load attendance records")}})}get isCheckedIn(){return!!this.allAttendances.find(a=>a.membershipNumber===this.membershipNumber&&!a.checkOutTime&&new Date(a.checkInTime).toDateString()===new Date().toDateString())}recordAttendance(){if(!this.membershipNumber){this.notificationService.showError("Please enter a membership number");return}this.isLoading=!0,(this.isCheckedIn?this.attendanceService.checkOut(this.membershipNumber):this.attendanceService.checkIn(this.membershipNumber)).subscribe({next:()=>{this.notificationService.showSuccess("Attendance recorded successfully"),this.membershipNumber="",this.loadAttendanceData()},error:a=>{this.isLoading=!1,this.notificationService.showError("Error: "+(a.message||"Unknown"))}})}calculateDuration(e){if(!e.checkOutTime)return"Active";let a=new Date(e.checkInTime).getTime(),m=new Date(e.checkOutTime).getTime()-a,s=Math.floor(m/(1e3*60*60)),k=Math.floor(m%(1e3*60*60)/(1e3*60));return s>0?`${s}h ${k}m`:`${k}m`}static \u0275fac=function(a){return new(a||t)(_(N),_(_e),_(P))};static \u0275cmp=M({type:t,selectors:[["app-tracker-attendance"]],standalone:!0,features:[w],decls:64,vars:12,consts:[[1,"container","attendance-container"],[1,"page-title"],[1,"stats-grid"],[1,"stat-card","fade-in"],[1,"stat-icon"],[1,"stat-info"],[1,"stat-value"],[1,"stat-label"],[1,"attendance-card","fade-in"],["appearance","outline",1,"membership-input"],["matInput","","placeholder","Enter membership number",3,"ngModelChange","ngModel","disabled"],["matSuffix",""],["mat-raised-button","","color","primary",3,"click","disabled"],[4,"ngIf"],["class","fade-in",4,"ngIf"],["mode","indeterminate"],[1,"fade-in"],[1,"table-container"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","membershipNumber"],["matColumnDef","checkInTime"],["matColumnDef","checkOutTime"],["matColumnDef","duration"],["matColumnDef","status"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"status-badge",3,"ngClass"],["mat-header-row",""],["mat-row",""]],template:function(a,o){a&1&&(i(0,"div",0)(1,"h1",1),r(2,"Daily Attendance Tracker (Admin)"),n(),i(3,"div",2)(4,"mat-card",3)(5,"mat-card-content")(6,"div",4)(7,"mat-icon"),r(8,"people"),n()(),i(9,"div",5)(10,"h2",6),r(11),n(),i(12,"p",7),r(13,"Total Users"),n()()()(),i(14,"mat-card",3)(15,"mat-card-content")(16,"div",4)(17,"mat-icon"),r(18,"admin_panel_settings"),n()(),i(19,"div",5)(20,"h2",6),r(21),n(),i(22,"p",7),r(23,"Administrators"),n()()()(),i(24,"mat-card",3)(25,"mat-card-content")(26,"div",4)(27,"mat-icon"),r(28,"checkin"),n()(),i(29,"div",5)(30,"h2",6),r(31),n(),i(32,"p",7),r(33,"Today's Check-ins"),n()()()(),i(34,"mat-card",3)(35,"mat-card-content")(36,"div",4)(37,"mat-icon"),r(38,"calendar_today"),n()(),i(39,"div",5)(40,"h2",6),r(41),n(),i(42,"p",7),r(43,"Weekly Check-ins"),n()()()()(),i(44,"mat-card",8)(45,"mat-card-header")(46,"mat-card-title"),r(47),n(),i(48,"mat-card-subtitle"),r(49,"Enter a member's number to record attendance"),n()(),i(50,"mat-card-content")(51,"mat-form-field",9)(52,"mat-label"),r(53,"Membership Number"),n(),i(54,"input",10),A("ngModelChange",function(s){return T(o.membershipNumber,s)||(o.membershipNumber=s),s}),n(),i(55,"mat-icon",11),r(56,"card_membership"),n()()(),i(57,"mat-card-actions")(58,"button",12),v("click",function(){return o.recordAttendance()}),i(59,"mat-icon"),r(60),n(),r(61),n()(),d(62,xe,2,0,"mat-card-footer",13),n(),d(63,Ne,27,3,"mat-card",14),n()),a&2&&(c(11),h(o.userCount),c(10),h(o.adminCount),c(10),h(o.todayAttendanceCount),c(10),h(o.weeklyAttendanceCount),c(6),p(" ",o.isCheckedIn?"Check Out":"Check In"," "),c(7),S("ngModel",o.membershipNumber),l("disabled",o.isLoading),c(4),l("disabled",o.isLoading||!o.membershipNumber),c(2),h(o.isCheckedIn?"exit_to_app":"login"),c(),p(" ",o.isCheckedIn?"Check Out":"Check In"," "),c(),l("ngIf",o.isLoading),c(),l("ngIf",o.recentAttendance.length>0))},dependencies:[y,D,I,O,K,q,G,J,j,H,$,z,W,U,B,R,ee,Z,Q,X,ne,te,L,F,Y,V,he,re,ce,se,me,oe,pe,de,le,ue,fe,ie,ae],styles:[".attendance-container[_ngcontent-%COMP%]{padding:24px;max-width:1200px;margin:auto}.page-title[_ngcontent-%COMP%]{text-align:center;margin-bottom:24px;font-size:1.8rem}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin-bottom:32px}.stat-card[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px;transition:transform .3s ease}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 4px 12px #00000026}.stat-icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background-color:var(--primary-light);color:#fff;width:60px;height:60px;border-radius:50%;margin-right:16px}.stat-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.stat-value[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700}.stat-label[_ngcontent-%COMP%]{font-size:1rem;color:#777}.attendance-card[_ngcontent-%COMP%]{margin-bottom:32px}.membership-input[_ngcontent-%COMP%]{width:100%}.status-badge[_ngcontent-%COMP%]{padding:4px 10px;border-radius:12px;color:#fff;font-size:.75rem;display:inline-block}.completed[_ngcontent-%COMP%]{background-color:#4caf50}.active[_ngcontent-%COMP%]{background-color:#f44336}.table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;margin-bottom:16px}table[_ngcontent-%COMP%]{width:100%;min-width:600px;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{white-space:nowrap;padding:8px 16px;text-align:left}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:12px;color:#fff;display:inline-block}.status-badge.active[_ngcontent-%COMP%]{background-color:#ff9800}.status-badge.completed[_ngcontent-%COMP%]{background-color:#4caf50}@media (max-width: 768px){mat-card-content[_ngcontent-%COMP%]{padding:8px 0}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:6px 10px;font-size:13px}.status-badge[_ngcontent-%COMP%]{font-size:11px;padding:3px 6px}}"]})};export{ge as TrackerAttendanceComponent};
