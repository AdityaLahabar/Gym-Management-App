import{a as T,b as O,h as y}from"./chunk-Z7C36ZZY.js";import{d as N}from"./chunk-EPAIRDRN.js";import{a as U,aa as d,ba as b,c as p,da as I,fa as c,jb as m,la as R,p as l,q as u,t as v,v as S,y as k,zc as f}from"./chunk-32E2X5NW.js";var M=(r=>(r.SUCCESS="success",r.ERROR="error",r.INFO="info",r.WARNING="warning",r))(M||{}),g=class o{nextId=0;notifications=m([]);showNotification(i,e,t=3e3){let r=this.nextId++;this.notifications.update(s=>[...s,{id:r,message:i,type:e,duration:t}]),setTimeout(()=>{this.removeNotification(r)},t)}removeNotification(i){this.notifications.update(e=>e.filter(t=>t.id!==i))}showSuccess(i){this.showNotification(i,"success")}showError(i){this.showNotification(i,"error",5e3)}showInfo(i){this.showNotification(i,"info")}showWarning(i){this.showNotification(i,"warning",4e3)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};var E=new I("JWT_OPTIONS"),w=(()=>{class o{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let s=0,a,n,h=0;n=e.charAt(h++);~n&&(a=s%4?a*64+n:n,s++%4)?r+=String.fromCharCode(255&a>>(-2*s&6)):0)n=t.indexOf(n);return r}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let r=new Date(0);return r.setUTCSeconds(t.exp),r}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(r=>this._isTokenExpired(r,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let r=this.getTokenExpirationDate(e);return t=t||0,r===null?!1:!(r.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return o.\u0275fac=function(e){return new(e||o)(c(E))},o.\u0275prov=d({token:o,factory:o.\u0275fac}),o})(),D=o=>o instanceof Promise?k(()=>o):l(o),_=(()=>{class o{constructor(e,t,r){this.jwtHelper=t,this.document=r,this.standardPorts=["80","443"],this.tokenGetter=e.tokenGetter,this.headerName=e.headerName||"Authorization",this.authScheme=e.authScheme||e.authScheme===""?e.authScheme:"Bearer ",this.allowedDomains=e.allowedDomains||[],this.disallowedRoutes=e.disallowedRoutes||[],this.throwNoTokenError=e.throwNoTokenError||!1,this.skipWhenExpired=e.skipWhenExpired}isAllowedDomain(e){let t=new URL(e.url,this.document.location.origin);if(t.host===this.document.location.host)return!0;let r=`${t.hostname}${t.port&&!this.standardPorts.includes(t.port)?":"+t.port:""}`;return this.allowedDomains.findIndex(s=>typeof s=="string"?s===r:s instanceof RegExp?s.test(r):!1)>-1}isDisallowedRoute(e){let t=new URL(e.url,this.document.location.origin);return this.disallowedRoutes.findIndex(r=>{if(typeof r=="string"){let s=new URL(r,this.document.location.origin);return s.hostname===t.hostname&&s.pathname===t.pathname}return r instanceof RegExp?r.test(e.url):!1})>-1}handleInterception(e,t,r){let s=this.jwtHelper.getAuthScheme(this.authScheme,t);if(!e&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let a=l(!1);return this.skipWhenExpired&&(a=e?D(this.jwtHelper.isTokenExpired(e)):l(!0)),e?a.pipe(v(n=>n&&this.skipWhenExpired?t.clone():t.clone({setHeaders:{[this.headerName]:`${s}${e}`}})),S(n=>r.handle(n))):r.handle(t)}intercept(e,t){if(!this.isAllowedDomain(e)||this.isDisallowedRoute(e))return t.handle(e);let r=this.tokenGetter(e);return D(r).pipe(S(s=>this.handleInterception(s,e,t)))}}return o.\u0275fac=function(e){return new(e||o)(c(E),c(w),c(N))},o.\u0275prov=d({token:o,factory:o.\u0275fac}),o})(),X=(()=>{class o{constructor(e){if(e)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(e){return{ngModule:o,providers:[{provide:O,useClass:_,multi:!0},e.jwtOptionsProvider||{provide:E,useValue:e.config},w]}}}return o.\u0275fac=function(e){return new(e||o)(c(o,12))},o.\u0275mod=R({type:o}),o.\u0275inj=b({}),o})();var C=[{id:"1",name:"Admin User",email:"admin@powerfit.com",password:"admin123",role:"admin",membershipNumber:"A001",createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()},{id:"2",name:"Regular Member",email:"member@powerfit.com",password:"member123",role:"member",membershipNumber:"M001",createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()}],A=class o{constructor(i,e,t,r){this.http=i;this.router=e;this.jwtHelper=t;this.notificationService=r}AUTH_KEY="access_token";USER_KEY="user_data";mockUsers=[...C];currentUserSignal=m(null);user=f(()=>this.currentUserSignal());isLoggedIn=f(()=>!!this.user());isAdmin=f(()=>this.user()?.role==="ROLE_ADMIN");checkAuthState(){let i=localStorage.getItem(this.AUTH_KEY),e=localStorage.getItem(this.USER_KEY);if(i&&e&&!this.jwtHelper.isTokenExpired(i))try{this.currentUserSignal.set(JSON.parse(e))}catch{this.logout()}else i&&this.logout()}login(i){let e=this.mockUsers.find(h=>h.email===i.email&&h.password===i.password);if(!e)return u(()=>new Error("Invalid email or password"));let n=e,{password:t}=n,r=p(n,["password"]),s=this.createMockJwt(r),a={user:r,token:s};return localStorage.setItem(this.AUTH_KEY,s),localStorage.setItem(this.USER_KEY,JSON.stringify(r)),this.currentUserSignal.set(r),this.notificationService.showSuccess("Login successful!"),l(a)}register(i){if(this.mockUsers.some(h=>h.email===i.email))return u(()=>new Error("Email already registered"));let e={id:(this.mockUsers.length+1).toString(),name:i.name,email:i.email,password:i.password,role:"member",membershipNumber:`M${(this.mockUsers.length+1).toString().padStart(3,"0")}`,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()};this.mockUsers.push(e);let n=e,{password:t}=n,r=p(n,["password"]),s=this.createMockJwt(r),a={user:r,token:s};return localStorage.setItem(this.AUTH_KEY,s),localStorage.setItem(this.USER_KEY,JSON.stringify(r)),this.currentUserSignal.set(r),this.notificationService.showSuccess("Registration successful!"),l(a)}logout(){localStorage.removeItem(this.AUTH_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSignal.set(null),this.router.navigate(["/login"]),this.notificationService.showInfo("You have been logged out")}getAllUsers(){return l(this.mockUsers.map(t=>{var r=t,{password:i}=r,e=p(r,["password"]);return e}))}updateUserRole(i,e){let t=this.mockUsers.findIndex(n=>n.id===i);if(t===-1)return u(()=>new Error("User not found"));if(this.mockUsers[t].role=e,this.user()?.id===i){let n=U({},this.mockUsers[t]);delete n.password,this.currentUserSignal.set(n),localStorage.setItem(this.USER_KEY,JSON.stringify(n))}let a=this.mockUsers[t],{password:r}=a,s=p(a,["password"]);return l(s)}deleteUser(i){let e=this.mockUsers.length;return this.mockUsers=this.mockUsers.filter(t=>t.id!==i),this.user()?.id===i&&this.logout(),l(this.mockUsers.length<e)}createMockJwt(i){let e={alg:"HS256",typ:"JWT"},t={sub:i.id,name:i.name,email:i.email,role:i.role,iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+3600},r=btoa(JSON.stringify(e)),s=btoa(JSON.stringify(t));return`${r}.${s}.mocksignature`}static \u0275fac=function(e){return new(e||o)(c(T),c(y),c(w),c(g))};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{X as a,M as b,g as c,A as d};
