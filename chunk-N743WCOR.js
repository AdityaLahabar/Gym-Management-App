import{a as Vt}from"./chunk-WNDP3CM5.js";import{a as St,b as Pt,c as Et,d as Rt,e as At,f as Lt,g as Bt,h as Ft,i as Ot,j as Nt,k as jt}from"./chunk-K7VD5AT2.js";import{b as Mt,e as Dt}from"./chunk-5VEWYAQD.js";import"./chunk-KXZ2SJFQ.js";import{a as It,b as wt}from"./chunk-RBCSQDVC.js";import{a as pt,b as ut}from"./chunk-VNYGLEJY.js";import{a as yt,c as Ct,f as kt,i as Tt,j as xt}from"./chunk-KJYWCLP3.js";import{b as _t,f as ft,i as gt,n as vt}from"./chunk-72S4KMMN.js";import"./chunk-EJJBCPAK.js";import{a as nt,b as rt,c as ot,d as st,e as ct,f as dt,g as lt,j as mt}from"./chunk-3TOQYKAU.js";import{c as tt,d as et}from"./chunk-UQLXCD4R.js";import{X as F,ma as at,pa as it,qa as bt,ra as ht}from"./chunk-EJYB65PO.js";import{j as Z,l as X,m as J}from"./chunk-N6P3D6GX.js";import{$a as b,$b as o,Eb as r,Fb as n,Gb as p,Hb as v,Ib as y,Kb as L,Pb as T,Rb as h,Sb as z,Tb as W,Ub as B,Vb as $,Wb as x,Xb as I,_a as s,ac as u,ba as N,bb as g,bc as _,cc as G,da as C,dc as q,ec as U,fc as w,gb as A,gc as M,ic as D,j as O,jc as S,ka as k,la as j,lb as H,ma as P,nb as Q,qb as l,ta as V,ua as E,va as R,vb as d,vc as K,xc as Y}from"./chunk-E777HTRJ.js";var qt=["*"];function Ut(t,i){t&1&&W(0)}var Kt=new C("MatTabContent"),Yt=(()=>{class t{constructor(e){this.template=e}static{this.\u0275fac=function(a){return new(a||t)(b(g))}}static{this.\u0275dir=P({type:t,selectors:[["","matTabContent",""]],standalone:!0,features:[w([{provide:Kt,useExisting:t}])]})}}return t})(),Zt=new C("MatTabLabel"),Ht=new C("MAT_TAB"),Xt=(()=>{class t extends Dt{constructor(e,a,c){super(e,a),this._closestTab=c}static{this.\u0275fac=function(a){return new(a||t)(b(g),b(A),b(Ht,8))}}static{this.\u0275dir=P({type:t,selectors:[["","mat-tab-label",""],["","matTabLabel",""]],standalone:!0,features:[w([{provide:Zt,useExisting:t}]),H]})}}return t})(),Jt=new C("MAT_TAB_GROUP"),Qt=(()=>{class t{get templateLabel(){return this._templateLabel}set templateLabel(e){this._setTemplateLabelInput(e)}get content(){return this._contentPortal}constructor(e,a){this._viewContainerRef=e,this._closestTabGroup=a,this.disabled=!1,this._explicitContent=void 0,this.textLabel="",this._contentPortal=null,this._stateChanges=new O,this.position=null,this.origin=null,this.isActive=!1}ngOnChanges(e){(e.hasOwnProperty("textLabel")||e.hasOwnProperty("disabled"))&&this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}ngOnInit(){this._contentPortal=new Mt(this._explicitContent||this._implicitContent,this._viewContainerRef)}_setTemplateLabelInput(e){e&&e._closestTab===this&&(this._templateLabel=e)}static{this.\u0275fac=function(a){return new(a||t)(b(A),b(Jt,8))}}static{this.\u0275cmp=k({type:t,selectors:[["mat-tab"]],contentQueries:function(a,c,m){if(a&1&&(B(m,Xt,5),B(m,Yt,7,g)),a&2){let f;x(f=I())&&(c.templateLabel=f.first),x(f=I())&&(c._explicitContent=f.first)}},viewQuery:function(a,c){if(a&1&&$(g,7),a&2){let m;x(m=I())&&(c._implicitContent=m.first)}},hostAttrs:["hidden",""],inputs:{disabled:[2,"disabled","disabled",K],textLabel:[0,"label","textLabel"],ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],labelClass:"labelClass",bodyClass:"bodyClass"},exportAs:["matTab"],standalone:!0,features:[w([{provide:Ht,useExisting:t}]),Q,V,M],ngContentSelectors:qt,decls:1,vars:0,template:function(a,c){a&1&&(z(),l(0,Ut,1,0,"ng-template"))},encapsulation:2})}}return t})();var zt=(()=>{class t{static{this.\u0275fac=function(a){return new(a||t)}}static{this.\u0275mod=j({type:t})}static{this.\u0275inj=N({imports:[F,F]})}}return t})();function ee(t,i){if(t&1&&(r(0,"div",12)(1,"p"),o(2," Your membership number: "),r(3,"strong"),o(4),n()()()),t&2){let e,a=h();s(4),u((e=a.user())==null?null:e.membershipNumber)}}function ae(t,i){if(t&1){let e=L();r(0,"button",13),T("click",function(){E(e);let c=h();return R(c.setCurrentUserMembershipNumber())}),o(1," Use My Number "),n()}if(t&2){let e=h();d("disabled",e.isLoading)}}function ie(t,i){t&1&&(r(0,"mat-card-footer"),p(1,"mat-progress-bar",14),n())}function ne(t,i){t&1&&(r(0,"h3",23),o(1," No attendance records found. "),n())}function re(t,i){t&1&&(r(0,"th",33),o(1,"Date"),n())}function oe(t,i){if(t&1&&(r(0,"td",34),o(1),D(2,"date"),n()),t&2){let e=i.$implicit;s(),_(" ",S(2,1,e.checkInTime,"mediumDate")," ")}}function se(t,i){t&1&&(r(0,"th",33),o(1,"Check In"),n())}function ce(t,i){if(t&1&&(r(0,"td",34),o(1),D(2,"date"),n()),t&2){let e=i.$implicit;s(),_(" ",S(2,1,e.checkInTime,"shortTime")," ")}}function de(t,i){t&1&&(r(0,"th",33),o(1,"Check Out"),n())}function le(t,i){if(t&1&&(r(0,"td",34),o(1),D(2,"date"),n()),t&2){let e=i.$implicit;s(),_(" ",e.checkOutTime?S(2,1,e.checkOutTime,"shortTime"):"Active"," ")}}function me(t,i){t&1&&(r(0,"th",33),o(1,"Duration"),n())}function be(t,i){if(t&1&&(r(0,"td",34),o(1),n()),t&2){let e=i.$implicit,a=h(3);s(),_(" ",a.calculateDuration(e)," ")}}function he(t,i){t&1&&p(0,"tr",35)}function pe(t,i){t&1&&p(0,"tr",36)}function ue(t,i){if(t&1&&(r(0,"table",24),v(1,25),l(2,re,2,0,"th",26)(3,oe,3,4,"td",27),y(),v(4,28),l(5,se,2,0,"th",26)(6,ce,3,4,"td",27),y(),v(7,29),l(8,de,2,0,"th",26)(9,le,3,4,"td",27),y(),v(10,30),l(11,me,2,0,"th",26)(12,be,2,1,"td",27),y(),l(13,he,1,0,"tr",31)(14,pe,1,0,"tr",32),n()),t&2){let e=h(2);d("dataSource",e.userAttendance),s(13),d("matHeaderRowDef",e.displayedColumns),s(),d("matRowDefColumns",e.displayedColumns)}}function _e(t,i){if(t&1&&(r(0,"div",37)(1,"div",38)(2,"div",39),o(3,"Total Check-ins"),n(),r(4,"div",40),o(5),n()(),p(6,"mat-divider"),r(7,"div",38)(8,"div",39),o(9,"This Week"),n(),r(10,"div",40),o(11),n()(),p(12,"mat-divider"),r(13,"div",38)(14,"div",39),o(15,"This Month"),n(),r(16,"div",40),o(17),n()(),p(18,"mat-divider"),r(19,"div",38)(20,"div",39),o(21,"Avg. Session Duration"),n(),r(22,"div",40),o(23),n()()()),t&2){let e=h(2);s(5),u(e.stats.totalCheckins),s(6),u(e.stats.weeklyCheckins),s(6),u(e.stats.monthlyCheckins),s(6),_(" ",e.stats.averageStayDuration," min ")}}function fe(t,i){t&1&&(r(0,"div",41)(1,"p"),o(2,"No attendance statistics available yet."),n()())}function ge(t,i){if(t&1&&(v(0),r(1,"mat-card",15)(2,"mat-tabs")(3,"mat-tab",16)(4,"div",17),l(5,ne,2,0,"h3",18)(6,ue,15,3,"table",19),n()(),r(7,"mat-tab",20),l(8,_e,24,4,"div",21)(9,fe,3,0,"div",22),n()()(),y()),t&2){let e=h();s(5),d("ngIf",e.userAttendance.length===0),s(),d("ngIf",e.userAttendance.length>0),s(2),d("ngIf",e.stats),s(),d("ngIf",!e.stats||e.stats.totalCheckins===0)}}var Wt=class t{constructor(i,e,a){this.attendanceService=i;this.authService=e;this.notificationService=a}membershipNumber="";isLoading=!1;userAttendance=[];stats=null;displayedColumns=["date","checkInTime","checkOutTime","duration"];ngOnInit(){this.loadUserAttendance()}user=Y(()=>this.authService.user());get isCheckedIn(){return this.userAttendance.length?!!this.userAttendance.find(e=>e.userId===this.user()?.id&&!e.checkOutTime&&new Date(e.checkInTime).setHours(0,0,0,0)===new Date().setHours(0,0,0,0)):!1}setCurrentUserMembershipNumber(){this.user()?.membershipNumber&&(this.membershipNumber=this.user()?.membershipNumber||"")}recordAttendance(){if(!this.membershipNumber){this.notificationService.showError("Please enter a membership number");return}this.isLoading=!0,this.isCheckedIn?this.attendanceService.checkOut(this.membershipNumber).subscribe({next:i=>{this.isLoading=!1,this.loadUserAttendance()},error:i=>{this.isLoading=!1,this.notificationService.showError(i.message||"Failed to check out")}}):this.attendanceService.checkIn(this.membershipNumber).subscribe({next:i=>{this.isLoading=!1,this.loadUserAttendance()},error:i=>{this.isLoading=!1,this.notificationService.showError(i.message||"Failed to check in")}})}loadUserAttendance(){this.user()&&(this.isLoading=!0,this.attendanceService.getUserAttendance(this.user().id).subscribe({next:i=>{this.userAttendance=i.sort((e,a)=>new Date(a.checkInTime).getTime()-new Date(e.checkInTime).getTime()),this.isLoading=!1,this.loadUserStats()},error:i=>{this.isLoading=!1,this.notificationService.showError("Failed to load attendance history")}}))}loadUserStats(){this.user()&&this.attendanceService.getUserStats(this.user().id).subscribe({next:i=>{this.stats=i},error:i=>{this.notificationService.showError("Failed to load attendance statistics")}})}calculateDuration(i){if(!i.checkOutTime)return"Active";let e=new Date(i.checkInTime).getTime(),c=new Date(i.checkOutTime).getTime()-e,m=Math.floor(c/(1e3*60*60)),f=Math.floor(c%(1e3*60*60)/(1e3*60));return m>0?`${m}h ${f}m`:`${f}m`}static \u0275fac=function(e){return new(e||t)(b(Vt),b(et),b(tt))};static \u0275cmp=k({type:t,selectors:[["app-attendance"]],standalone:!0,features:[M],decls:27,vars:11,consts:[[1,"container","attendance-container"],[1,"page-title"],[1,"attendance-content"],[1,"attendance-card","fade-in"],[1,"attendance-form"],["appearance","outline",1,"membership-input"],["matInput","","placeholder","Enter your membership number",3,"ngModelChange","ngModel","disabled"],["matSuffix",""],["class","current-user-info",4,"ngIf"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-button","",3,"disabled","click",4,"ngIf"],[4,"ngIf"],[1,"current-user-info"],["mat-button","",3,"click","disabled"],["mode","indeterminate"],[1,"attendance-records-card","fade-in"],["label","Attendance History"],[1,"attendance-history-content"],["class","no-records-message",4,"ngIf"],["mat-table","",3,"dataSource",4,"ngIf"],["label","Statistics"],["class","attendance-stats-content",4,"ngIf"],["class","no-stats-message",4,"ngIf"],[1,"no-records-message"],["mat-table","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","checkInTime"],["matColumnDef","checkOutTime"],["matColumnDef","duration"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[1,"attendance-stats-content"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value"],[1,"no-stats-message"]],template:function(e,a){if(e&1&&(r(0,"div",0)(1,"h1",1),o(2,"Attendance"),n(),r(3,"div",2)(4,"mat-card",3)(5,"mat-card-header")(6,"mat-card-title"),o(7),n(),r(8,"mat-card-subtitle"),o(9),n()(),r(10,"mat-card-content")(11,"div",4)(12,"mat-form-field",5)(13,"mat-label"),o(14,"Membership Number"),n(),r(15,"input",6),U("ngModelChange",function(m){return q(a.membershipNumber,m)||(a.membershipNumber=m),m}),n(),r(16,"mat-icon",7),o(17,"card_membership"),n()(),l(18,ee,5,1,"div",8),n()(),r(19,"mat-card-actions")(20,"button",9),T("click",function(){return a.recordAttendance()}),r(21,"mat-icon"),o(22),n(),o(23),n(),l(24,ae,2,1,"button",10),n(),l(25,ie,2,0,"mat-card-footer",11),n(),l(26,ge,10,4,"ng-container",11),n()()),e&2){let c;s(7),u(a.isCheckedIn?"Check Out":"Check In"),s(2),_(" ",a.isCheckedIn?"Record your exit time":"Record your gym visit"," "),s(6),G("ngModel",a.membershipNumber),d("disabled",a.isLoading),s(3),d("ngIf",a.user()),s(2),d("disabled",a.isLoading||!a.membershipNumber),s(2),u(a.isCheckedIn?"exit_to_app":"login"),s(),_(" ",a.isCheckedIn?"Check Out":"Check In"," "),s(),d("ngIf",((c=a.user())==null?null:c.membershipNumber)&&!a.membershipNumber),s(),d("ngIf",a.isLoading),s(),d("ngIf",a.user())}},dependencies:[J,Z,X,vt,_t,ft,gt,mt,nt,ct,ot,lt,dt,st,rt,xt,Tt,kt,yt,Ct,it,at,ht,bt,zt,Qt,jt,St,Et,Bt,Rt,Pt,Ft,At,Lt,Ot,Nt,wt,It,ut,pt],styles:[".attendance-container[_ngcontent-%COMP%]{padding:24px 16px}.page-title[_ngcontent-%COMP%]{margin-bottom:24px;text-align:center}.attendance-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px;max-width:800px;margin:0 auto}.attendance-card[_ngcontent-%COMP%], .attendance-records-card[_ngcontent-%COMP%]{width:100%}.attendance-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;margin:16px 0}.membership-input[_ngcontent-%COMP%]{width:100%}.current-user-info[_ngcontent-%COMP%]{margin:8px 0;font-size:.9rem;color:var(--gray-700)}.mat-mdc-card-actions[_ngcontent-%COMP%]{display:flex;gap:8px;padding:16px}.attendance-history-content[_ngcontent-%COMP%], .attendance-stats-content[_ngcontent-%COMP%]{padding:16px}.no-records-message[_ngcontent-%COMP%], .no-stats-message[_ngcontent-%COMP%]{text-align:center;padding:24px;color:var(--gray-600)}table[_ngcontent-%COMP%]{width:100%}.stat-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 0}.stat-label[_ngcontent-%COMP%]{font-weight:500;color:var(--gray-700)}.stat-value[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--primary)}@media (max-width: 768px){.attendance-content[_ngcontent-%COMP%]{gap:16px}.stat-item[_ngcontent-%COMP%]{padding:12px 0}}"]})};export{Wt as AttendanceComponent};
